<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="todo-list.html">
<link rel="import" href="todo-list-input.html">

<dom-module id="todo-app">
    <template>
        <style>
            todo-list,
            todo-list-input {
                margin: 1rem;
            }
        </style>
        <dom-repeat items="{{todoLists}}">
            <template>
                <todo-list todo-list="{{item}}">
                    <span slot="name">{{item.name}}</span>
                </todo-list>
            </template>
        </dom-repeat>
        <todo-list-input id="todoListInput"
             on-todo-list="_saveTodo">
        </todo-list-input>
    </template>
    <script>
        class TodoApp extends Polymer.Element {
            static get is() { return 'todo-app';}

            static get config() {
                return {
                    properties: {
                        todoLists: {
                            type: Array
                        }
                    }
                };
            }

            _saveTodo(e) {
                let todoList = e.detail;
                this.service.saveTodoList(todoList).then(() => {
                    this.$.todoListInput.todoList = new TodoListModel();
                    this._getAllTodos();
                });
            }

            _getAllTodos() {
                this.service.getAllTodoLists().then(todoLists => {
                    this.todoLists = todoLists;
                });
            }

            constructor() {
                super();
                this.service = new TodoListService("todolist");
                this._getAllTodos();
            }

            connectedCallback() {
                super.connectedCallback();
            }

            disconnectedCallback() {
                super.disconnectedCallback();
            }
        }
        customElements.define(TodoApp.is, TodoApp);
    </script>
</dom-module>
